<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter
[
  <!ENTITY % entities SYSTEM "entity-decl.ent">
    %entities;
]>
<chapter version="5.1" xml:id="cha.admin.monitoring"
  xmlns="http://docbook.org/ns/docbook"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  xmlns:xlink="http://www.w3.org/1999/xlink">
 <info>
  <title>Monitoring</title>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>

 <sect1 xml:id="sec.admin.cluster-monitoring">
  <title>Cluster Monitoring</title>

  <para>
   There are three basic ways how you can monitor your cluster:
  </para>

  <itemizedlist>
   <listitem>
    <para>
     by directly accessing the <link xlink:href="https://github.com/google/cadvisor">cAdvisor</link>
     on <literal>http://<replaceable>WORKER NODE ADDRESS</replaceable>:4194/containers/</literal>.
     The <emphasis>cAdvisor</emphasis> runs on worker nodes by default.
    </para>
   </listitem>
   <listitem>
    <para>
     By using <link xlink:href="https://github.com/kubernetes/heapster">Heapster</link>, for details refer to
     <xref linkend="sec.admin.cluster-monitoring.heapster"/>.
    </para>
   </listitem>
   <listitem>
    <para>
     By using <link xlink:href="https://grafana.com/">Grafana</link>, for details refer to
     <xref linkend="sec.admin.cluster-monitoring.grafana"/>.
    </para>
   </listitem>
  </itemizedlist>

  <sect2 xml:id="sec.admin.cluster-monitoring.heapster">
   <title>Monitoring with Heapster</title>
   <para>
    <emphasis>Heapster</emphasis> is a tool that collects and interprets
    various signals from your cluster. <emphasis>Heapster</emphasis>
    communicates directly with the <emphasis>cAdvisor</emphasis>. The signals
    from the cluster are then exported using REST endpoints.
   </para>
   <para>
    To deploy <emphasis>Heapster</emphasis>, refer to
    <xref linkend="sec.admin.software.helm.installing-heapster"/>
   </para>
   <para>
     <emphasis>Heapster</emphasis> can store data in
     <emphasis>InfluxDB</emphasis>, which can be then used by other tools.
   </para>
  </sect2>

  <sect2 xml:id="sec.admin.cluster-monitoring.grafana">
   <title>Monitoring with Grafana</title>
   <para>
    <emphasis>Grafana</emphasis> is an analytics platform that processes data
    stored in <emphasis>InfluxDB</emphasis> and displays the data graphically.
    You can deploy <emphasis>Grafana</emphasis> by running the following
    commands:
   </para>
   <procedure>
    <title>Deploying Grafana And Required Components</title>
    <step>
     <para>
      Install heapster as described in
      <xref linkend="sec.admin.software.helm.installing-heapster"/>.
     </para>
    </step>
    <step>
     <para>
      Install InfluxDB.
     </para>
<screen>&prompt.root;<command>helm install stable/influxdb \
--name influxdb \
--namespace=kube-system</command>
     </screen>
    </step>
    <step>
     <para>
      Install grafana.
     </para>
<screen>&prompt.root;<command>helm install --name heapster-default \
--namespace=kube-system stable/grafana \
--version=1.14.0 \
--set spec.type=NodePort</command></screen>
</step>
   </procedure>
  </sect2>
 </sect1>
</chapter>
